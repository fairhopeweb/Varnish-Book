<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1060" height="964pt" viewBox="0 0 795 964"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 960)"><title>varnishfsm</title><polygon fill="#fff" stroke="transparent" points="-4 4 -4 -960 791 -960 791 4 -4 4"/><g id="clust1" class="cluster"><title>clusterfrontend</title><polygon fill="none" stroke="#000" points="8 -8 8 -893 779 -893 779 -8 8 -8"/><text x="144" y="-877.8" font-family="Times,serif" font-size="14" text-anchor="middle">Frontend (From Client) Workthread</text></g><g id="clust4" class="cluster"><title>clusterbackend</title><polygon fill="#f0f8ff" stroke="#000" points="67 -171 67 -552 517 -552 517 -171 67 -171"/><text x="192" y="-536.8" font-family="Times,serif" font-size="14" text-anchor="middle">Backend (To Server) Workthread</text></g><g id="node1" class="node"><title>Request</title><polygon fill="none" stroke="#000" points="332 -956 263.13 -938 332 -920 400.87 -938 332 -956"/><polyline fill="none" stroke="#000" points="274.74 -941.03 274.74 -934.97"/><polyline fill="none" stroke="#000" points="320.39 -923.03 343.61 -923.03"/><polyline fill="none" stroke="#000" points="389.26 -934.97 389.26 -941.03"/><polyline fill="none" stroke="#000" points="343.61 -952.97 320.39 -952.97"/><text x="332" y="-934.3" font-family="Times,serif" font-size="14" text-anchor="middle">Request</text></g><g id="node3" class="node"><title>vcl_recv</title><ellipse cx="407" cy="-844" fill="none" stroke="#000" rx="48.19" ry="18"/><text x="407" y="-840.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_recv</text></g><g id="edge1" class="edge"><title>Request-&gt;vcl_recv</title><path fill="none" stroke="#000" d="M343.72,-922.62C355.33,-908.38 373.34,-886.29 387.18,-869.31"/><polygon fill="#000" stroke="#000" points="389.99 -871.41 393.59 -861.45 384.56 -866.99 389.99 -871.41"/></g><g id="node2" class="node"><title>restart1</title><polygon fill="none" stroke="#000" points="483 -956 418.82 -938 483 -920 547.18 -938 483 -956"/><polyline fill="none" stroke="#000" points="430.37 -941.24 430.37 -934.76"/><polyline fill="none" stroke="#000" points="471.45 -923.24 494.55 -923.24"/><polyline fill="none" stroke="#000" points="535.63 -934.76 535.63 -941.24"/><polyline fill="none" stroke="#000" points="494.55 -952.76 471.45 -952.76"/><text x="483" y="-934.3" font-family="Times,serif" font-size="14" text-anchor="middle">Restart</text></g><g id="edge2" class="edge"><title>restart1-&gt;vcl_recv</title><path fill="none" stroke="#000" d="M471.46,-923.03C459.75,-908.86 441.4,-886.64 427.27,-869.53"/><polygon fill="#000" stroke="#000" points="429.78 -867.08 420.71 -861.6 424.38 -871.54 429.78 -867.08"/></g><g id="node9" class="node"><title>vcl_hash</title><ellipse cx="407" cy="-757" fill="none" stroke="#000" rx="50.09" ry="18"/><text x="407" y="-753.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_hash</text></g><g id="edge3" class="edge"><title>vcl_recv-&gt;vcl_hash</title><path fill="none" stroke="#000" d="M407,-825.8C407,-814.16 407,-798.55 407,-785.24"/><polygon fill="#000" stroke="#000" points="410.5 -785.18 407 -775.18 403.5 -785.18 410.5 -785.18"/><text x="431" y="-796.8" font-family="Times,serif" font-size="14" text-anchor="middle">lookup</text></g><g id="node4" class="node"><title>vcl_deliver</title><ellipse cx="185" cy="-124" fill="none" stroke="#000" rx="60.39" ry="18"/><text x="185" y="-120.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_deliver</text></g><g id="node12" class="node"><title>Done</title><polygon fill="none" stroke="#000" points="552.5 -69 499.5 -69 499.5 -16 552.5 -16 552.5 -69"/><polyline fill="none" stroke="#000" points="511.5 -69 499.5 -57"/><polyline fill="none" stroke="#000" points="499.5 -28 511.5 -16"/><polyline fill="none" stroke="#000" points="540.5 -16 552.5 -28"/><polyline fill="none" stroke="#000" points="552.5 -57 540.5 -69"/><text x="526" y="-38.8" font-family="Times,serif" font-size="14" text-anchor="middle">Done</text></g><g id="edge27" class="edge"><title>vcl_deliver-&gt;Done</title><path fill="none" stroke="#000" d="M230.99,-112.28C299.53,-96.3 427.09,-66.56 489.59,-51.99"/><polygon fill="#000" stroke="#000" points="490.45 -55.38 499.4 -49.7 488.86 -48.56 490.45 -55.38"/></g><g id="node5" class="node"><title>vcl_synth</title><ellipse cx="526" cy="-124" fill="none" stroke="#000" rx="53.89" ry="18"/><text x="526" y="-120.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_synth</text></g><g id="edge28" class="edge"><title>vcl_synth-&gt;Done</title><path fill="none" stroke="#000" d="M526,-105.75C526,-97.99 526,-88.51 526,-79.32"/><polygon fill="#000" stroke="#000" points="529.5 -79.18 526 -69.18 522.5 -79.18 529.5 -79.18"/></g><g id="node6" class="node"><title>vcl_hit</title><ellipse cx="57" cy="-670" fill="none" stroke="#000" rx="40.89" ry="18"/><text x="57" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_hit</text></g><g id="edge13" class="edge"><title>vcl_hit-&gt;vcl_deliver</title><path fill="none" stroke="#006400" d="M56.62,-651.78C56.34,-637.41 56,-616.37 56,-598 56,-598 56,-598 56,-196 56,-184.46 55.21,-179.51 63,-171 78.78,-153.78 101.66,-142.96 123.36,-136.19"/><polygon fill="#006400" stroke="#006400" points="124.57 -139.48 133.21 -133.36 122.63 -132.76 124.57 -139.48"/></g><g id="node11" class="node"><title>vcl_pass</title><ellipse cx="203" cy="-597" fill="none" stroke="#000" rx="49.29" ry="18"/><text x="203" y="-593.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_pass</text></g><g id="edge14" class="edge"><title>vcl_hit-&gt;vcl_pass</title><path fill="none" stroke="red" d="M82.93,-655.87C96.6,-648.98 113.67,-640.46 129,-633 140.48,-627.41 153.02,-621.44 164.46,-616.03"/><polygon fill="red" stroke="red" points="166.2 -619.08 173.76 -611.65 163.22 -612.75 166.2 -619.08"/></g><g id="node7" class="node"><title>vcl_miss</title><ellipse cx="353" cy="-670" fill="none" stroke="#000" rx="50.09" ry="18"/><text x="353" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_miss</text></g><g id="edge18" class="edge"><title>vcl_miss-&gt;vcl_pass</title><path fill="none" stroke="red" d="M323.72,-655.14C300.11,-643.96 266.71,-628.16 241.03,-616"/><polygon fill="red" stroke="red" points="242.48 -612.82 231.95 -611.7 239.49 -619.14 242.48 -612.82"/></g><g id="node14" class="node"><title>vcl_backend_fetch</title><ellipse cx="267" cy="-503" fill="none" stroke="#000" rx="94.78" ry="18"/><text x="267" y="-499.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_fetch</text></g><g id="edge15" class="edge"><title>vcl_miss-&gt;vcl_backend_fetch</title><path fill="none" stroke="#00f" d="M344.28,-652.27C329.29,-623.51 298.53,-564.5 280.67,-530.23"/><polygon fill="#00f" stroke="#00f" points="283.73 -528.52 276 -521.27 277.52 -531.75 283.73 -528.52"/></g><g id="node8" class="node"><title>vcl_purge</title><ellipse cx="477" cy="-670" fill="none" stroke="#000" rx="55.79" ry="18"/><text x="477" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_purge</text></g><g id="edge12" class="edge"><title>vcl_purge-&gt;vcl_synth</title><path fill="none" stroke="purple" d="M497.45,-652.94C511.64,-639.86 528,-620.01 528,-598 528,-598 528,-598 528,-196 528,-181.65 527.59,-165.67 527.14,-152.51"/><polygon fill="purple" stroke="purple" points="530.62 -152.08 526.76 -142.21 523.63 -152.33 530.62 -152.08"/></g><g id="edge7" class="edge"><title>vcl_hash-&gt;vcl_hit</title><path fill="none" stroke="#006400" d="M357.44,-753.99C284.4,-750.4 151.86,-741.25 109,-721 96.31,-715.01 84.77,-704.68 75.8,-694.96"/><polygon fill="#006400" stroke="#006400" points="78.4 -692.62 69.19 -687.4 73.13 -697.23 78.4 -692.62"/><text x="119" y="-709.8" font-family="Times,serif" font-size="14" text-anchor="middle">hit</text></g><g id="edge8" class="edge"><title>vcl_hash-&gt;vcl_miss</title><path fill="none" stroke="#00f" d="M396.33,-739.21C388.57,-726.98 377.91,-710.21 369.11,-696.36"/><polygon fill="#00f" stroke="#00f" points="371.96 -694.32 363.65 -687.76 366.05 -698.08 371.96 -694.32"/><text x="400" y="-709.8" font-family="Times,serif" font-size="14" text-anchor="middle">miss</text></g><g id="edge11" class="edge"><title>vcl_hash-&gt;vcl_purge</title><path fill="none" stroke="purple" d="M420.5,-739.61C430.79,-727.11 445.14,-709.69 456.8,-695.53"/><polygon fill="purple" stroke="purple" points="459.65 -697.57 463.31 -687.63 454.25 -693.12 459.65 -697.57"/><text x="467.5" y="-709.8" font-family="Times,serif" font-size="14" text-anchor="middle">purge</text></g><g id="node10" class="node"><title>vcl_pipe</title><ellipse cx="599" cy="-670" fill="none" stroke="#000" rx="48.19" ry="18"/><text x="599" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_pipe</text></g><g id="edge4" class="edge"><title>vcl_hash-&gt;vcl_pipe</title><path fill="none" stroke="orange" d="M439.44,-743.28C455.62,-736.81 475.44,-728.71 493,-721 516,-710.9 541.47,-698.92 561.67,-689.21"/><polygon fill="orange" stroke="orange" points="563.36 -692.29 570.85 -684.79 560.32 -685.98 563.36 -692.29"/><text x="540.5" y="-709.8" font-family="Times,serif" font-size="14" text-anchor="middle">pipe</text></g><g id="edge5" class="edge"><title>vcl_hash-&gt;vcl_pass</title><path fill="none" stroke="red" d="M357.74,-753.53C314.39,-750.02 250.21,-741.53 198,-721 173.22,-711.26 160.62,-711.45 148,-688 140.42,-673.91 141.81,-666.75 148,-652 153.23,-639.54 162.89,-628.5 172.68,-619.71"/><polygon fill="red" stroke="red" points="175.07 -622.27 180.47 -613.15 170.57 -616.91 175.07 -622.27"/><text x="164.5" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">pass</text></g><g id="edge9" class="edge"><title>vcl_hash-&gt;vcl_pass</title><path fill="none" stroke="red" d="M357.7,-753.19C312.29,-747.77 246.84,-732.21 212,-688 198.22,-670.52 196.94,-644.8 198.54,-625.33"/><polygon fill="red" stroke="red" points="202.04 -625.57 199.67 -615.25 195.08 -624.8 202.04 -625.57"/><text x="253" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">hit-for-pass</text></g><g id="node13" class="node"><title>waiting</title><polygon fill="none" stroke="#000" points="770.57 -670 744.28 -688 691.72 -688 665.43 -670 691.72 -652 744.28 -652 770.57 -670"/><text x="718" y="-666.3" font-family="Times,serif" font-size="14" text-anchor="middle">waiting</text></g><g id="edge10" class="edge"><title>vcl_hash-&gt;waiting</title><path fill="none" stroke="#000" d="M449.44,-747.26C480.28,-740.68 522.93,-731.09 560,-721 598.83,-710.43 642.39,-696.49 673.92,-686.01"/><polygon fill="#000" stroke="#000" points="675.34 -689.23 683.72 -682.74 673.13 -682.59 675.34 -689.23"/><text x="625" y="-709.8" font-family="Times,serif" font-size="14" text-anchor="middle">busy</text></g><g id="edge6" class="edge"><title>vcl_pipe-&gt;Done</title><path fill="none" stroke="orange" d="M599,-651.78C599,-637.41 599,-616.37 599,-598 599,-598 599,-598 599,-123 599,-98.35 579.73,-78.05 560.99,-64.13"/><polygon fill="orange" stroke="orange" points="562.97 -61.24 552.77 -58.37 558.95 -66.97 562.97 -61.24"/></g><g id="edge17" class="edge"><title>vcl_pass-&gt;vcl_backend_fetch</title><path fill="none" stroke="red" d="M214.74,-579.13C224.42,-565.21 238.31,-545.25 249.33,-529.4"/><polygon fill="red" stroke="red" points="252.28 -531.29 255.12 -521.08 246.54 -527.29 252.28 -531.29"/></g><g id="edge16" class="edge"><title>waiting-&gt;vcl_hash</title><path fill="none" stroke="#000" d="M698.66,-688.16C684.93,-699.36 665.53,-713.28 646,-721 588.1,-743.87 516.99,-751.99 467.46,-754.77"/><polygon fill="#000" stroke="#000" points="467.04 -751.28 457.23 -755.28 467.39 -758.28 467.04 -751.28"/></g><g id="node15" class="node"><title>decision1</title><polygon fill="none" stroke="#000" points="267 -448 110.99 -430 267 -412 423.01 -430 267 -448"/><text x="267" y="-426.3" font-family="Times,serif" font-size="14" text-anchor="middle">read beresp(headers)</text></g><g id="edge19" class="edge"><title>vcl_backend_fetch-&gt;decision1</title><path fill="none" stroke="#000" d="M267,-484.81C267,-476.79 267,-467.05 267,-458.07"/><polygon fill="#000" stroke="#000" points="270.5 -458.03 267 -448.03 263.5 -458.03 270.5 -458.03"/></g><g id="node16" class="node"><title>vcl_backend_response</title><ellipse cx="188" cy="-357" fill="none" stroke="#000" rx="113.18" ry="18"/><text x="188" y="-353.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_response</text></g><g id="edge20" class="edge"><title>decision1-&gt;vcl_backend_response</title><path fill="none" stroke="#000" d="M249.86,-413.59C239.53,-404.32 226.17,-392.31 214.51,-381.83"/><polygon fill="#000" stroke="#000" points="216.54 -378.95 206.77 -374.87 211.86 -384.15 216.54 -378.95"/></g><g id="node17" class="node"><title>vcl_backend_error</title><ellipse cx="414" cy="-357" fill="none" stroke="#000" rx="94.78" ry="18"/><text x="414" y="-353.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_error</text></g><g id="edge21" class="edge"><title>decision1-&gt;vcl_backend_error</title><path fill="none" stroke="#000" d="M295.69,-415.14C317.4,-404.66 347.54,-390.1 371.97,-378.3"/><polygon fill="#000" stroke="#000" points="373.54 -381.43 381.02 -373.93 370.49 -375.13 373.54 -381.43"/></g><g id="node18" class="node"><title>decision4</title><polygon fill="none" stroke="#000" points="188 -302 100.86 -284 188 -266 275.14 -284 188 -302"/><text x="188" y="-280.3" font-family="Times,serif" font-size="14" text-anchor="middle">cacheable?</text></g><g id="edge22" class="edge"><title>vcl_backend_response-&gt;decision4</title><path fill="none" stroke="#000" d="M188,-338.81C188,-330.79 188,-321.05 188,-312.07"/><polygon fill="#000" stroke="#000" points="191.5 -312.03 188 -302.03 184.5 -312.03 191.5 -312.03"/></g><g id="node19" class="node"><title>cache</title><polygon fill="none" stroke="#000" points="174.5 -215 117.5 -215 117.5 -179 174.5 -179 174.5 -215"/><text x="146" y="-193.3" font-family="Times,serif" font-size="14" text-anchor="middle">cache</text></g><g id="edge23" class="edge"><title>decision4-&gt;cache</title><path fill="none" stroke="green" d="M180.3,-267.41C174.37,-255.42 166.04,-238.56 159.08,-224.47"/><polygon fill="green" stroke="green" points="162.09 -222.66 154.52 -215.25 155.81 -225.76 162.09 -222.66"/><text x="181.5" y="-236.8" font-family="Times,serif" font-size="14" text-anchor="middle">yes</text></g><g id="node20" class="node"><title>nocache</title><polygon fill="none" stroke="#000" points="299.5 -215 192.5 -215 192.5 -179 299.5 -179 299.5 -215"/><text x="246" y="-193.3" font-family="Times,serif" font-size="14" text-anchor="middle">do not cache</text></g><g id="edge24" class="edge"><title>decision4-&gt;nocache</title><path fill="none" stroke="red" d="M197.96,-267.58C204.44,-257.65 213.11,-244.49 221,-233 223.16,-229.86 225.45,-226.58 227.73,-223.35"/><polygon fill="red" stroke="red" points="230.72 -225.18 233.67 -215 225.02 -221.12 230.72 -225.18"/><text x="262" y="-236.8" font-family="Times,serif" font-size="14" text-anchor="middle">hit-for-pass</text></g><g id="edge25" class="edge"><title>cache-&gt;vcl_deliver</title><path fill="none" stroke="green" d="M155.44,-178.81C160.04,-170.44 165.67,-160.2 170.77,-150.9"/><polygon fill="green" stroke="green" points="173.9 -152.48 175.65 -142.03 167.76 -149.11 173.9 -152.48"/></g><g id="edge26" class="edge"><title>nocache-&gt;vcl_deliver</title><path fill="none" stroke="red" d="M231.23,-178.81C223.63,-169.96 214.23,-159.02 205.9,-149.32"/><polygon fill="red" stroke="red" points="208.38 -146.84 199.21 -141.54 203.07 -151.41 208.38 -146.84"/></g></g></svg>